#### J

如果第 $i$ 个玩家发射的子弹最终击中了第 $j$ 个玩家，那么我们从 $i$ 向 $j$ 连一条有向边，容易发现最终构成的图是若干条有向链，且存活人数即为链的数量（存活的玩家为每条链链头）。

我们还可以观察到，每条链的点编号，实际上是一个区间 $[l,r]$（因为任何两条不同的链点编号区间不能相交），于是我们可以把这个题看成一个区间 DP 状物，令 $W_{l,r}$ 表示区间 $[l,r]$ 恰好构成一条链的概率，那么有 $k$ 个玩家存活的方案数实际上是，对于每一种对原序列的大小为 $k$ 的不交区间划分 $[l_1,r_1],[l_2,r_2]\dots [l_k,r_k](l_1=1,l_i\leq r_i,r_{i+1}=l_i+1,r_k=n)$, 对其 $\prod W_{l_i,r_i}$ 求和，这个是一个类似背包的 DP，容易做到 $O(n^3)$。

最终即是要计算 $W$，可以发现，如果一个区间恰好构成一条链，那么这个区间的子弹不能飞到区间外面（除非 $l=1$ 或 $r=n$，可以用简单的特判处理），那么对于区间内部，最终有 $r-l$ 发子弹成功发射，也就是说，除了第一发子弹，其余所有子弹击中的都是已经发射过子弹的其他玩家。所以最终区间一定形如 $\texttt{RRRRRLLLLL}$ 的形式，然后从是中间的 $\texttt{R}$ 或 $\texttt{L}$ 开始。之后的方案数是 $\texttt{R}$ 和 $\texttt{L}$ 内部分别满足相对顺序即可，因此方案数是组合数。直接实现是 $O(n^3)$ 的，也可以略微优化做到 $O(n^2)$ 不过没必要。

最终总复杂度是 $O(n^3)$。
